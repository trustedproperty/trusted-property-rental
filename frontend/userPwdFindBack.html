<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="Cache" content="no-cache">
    <title>场地派 - 场地日租平台</title>
    <!-- 作者：李浩铭   -->
    <link rel="shortcut icon" type="image/x-icon" href="images\www.favicon.ico" media="screen" />
    <!-- -->
    <!-- -->
    <!-- -->
    <!-- css:Bootstrap -->
    <link href="libs/bootstrap-3.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- css:bootstrap-datetimepicker -->
    <link href="css/bootstrap-datetimepicker.min.css" rel="stylesheet">
    <!-- css:自定义 -->
    <link rel="stylesheet" media="all" href="css/global.css" />
    <!-- -->
    <!-- -->
    <!-- -->
</head>

<body ng-app="appUserPwdFindBack" ng-controller="userPwdFindBackController as controller">
    <!-- -->
    <!-- -->
    <!-- -->
    <div hidden>通过 20160816 1818</div>
    <!-- -->
    <!-- -->
    <!-- -->
    <div class="header"></div>
    <!-- -->
    <!-- -->
    <!-- -->
    <!-- 清除浮动 -->
    <div class="clearfix" style="margin-bottom: 40px;">
    </div>
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="col-sm-12">
                <center>
                    <h4>找回密码</h4></center>
            </div>
        </div>
        <!-- 清除浮动 -->
        <div class="clearfix" style="margin-bottom: 30px;">
        </div>
        <div class="row-fluid">
            <div class="col-sm-12">
                <form class="form-horizontal" id="idUserPwdFindBackForm" name="nameUserPwdFindBackForm" accept-charset="UTF-8" ng-submit="submit()" novalidate="novalidate" autocomplete="off">
                    <fieldset>
                        <div class="form-group" ng-class="{'has-error':nameUserPwdFindBackForm.userPass.$invalid && ( submitted || nameUserPwdFindBackForm.userPass.$touched )}">
                            <div class="col-sm-4">
                                <label class="form-control-label">新密码</label>
                            </div>
                            <div class="col-sm-4">
                                <div class="col-sm-12">
                                    <i class="icon">&#xe600 </i>
                                    <input class="form-control iconInput" id="inputPWD1_UserPwdFindBack_HTML" type="password" placeholder="密码" name="userPass" ng-model="controller.userPass" required ng-maxlength="18" ng-minlength="6" ng-pattern="/[a-zA-Z]\w{5,17}$/" />
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="help-block" ng-messages="nameUserPwdFindBackForm.userPass.$error" ng-if="nameUserPwdFindBackForm.userPass.$invalid">
                                    <p ng-message="required" ng-bind="'*必填'" ng-cloak></p>
                                    <p ng-message="maxlength" ng-bind="'*密码最多18位'" ng-cloak></p>
                                    <p ng-message="minlength" ng-bind="'*密码至少6位'" ng-cloak></p>
                                    <p ng-message="pattern" ng-bind="'*密码必须以字母开头，且只能包含字符、数字和下划线'" ng-cloak></p>
                                </div>
                            </div>
                        </div>
                        <!--    -->
                        <!--    -->
                        <!--    -->
                        <div class="form-group" ng-class="{'has-error':(nameUserPwdFindBackForm.userPassSure.$invalid || nameUserPwdFindBackForm.userPassEqual.$invalid) && ( submitted || nameUserPwdFindBackForm.userPassSure.$touched)}">
                            <div class="col-sm-4">
                                <label class="form-control-label">确认密码</label>
                            </div>
                            <div class="col-sm-4">
                                <div class="col-sm-12">
                                    <i class="icon">&#xe600</i>
                                    <input class="form-control iconInput" id="inputPWD2_UserPwdFindBack_HTML" placeholder="密码" type="password" name="userPassSure" ng-model="controller.userPassSure" required/>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="help-block" ng-messages="nameUserPwdFindBackForm.userPassSure.$error" ng-if="nameUserPwdFindBackForm.userPassSure.$invalid">
                                    <p ng-message="required" ng-bind="'*必填'" ng-cloak></p>
                                </div>
                                <div class="help-block" ng-messages="nameUserPwdFindBackForm.userPassEqual.$error" ng-if="nameUserPwdFindBackForm.userPassEqual.$invalid">
                                    <p ng-message="minlength" ng-bind="'*两次密码不一致'"></p>
                                </div>
                            </div>
                        </div>
                        <!--    -->
                        <!--    -->
                        <!--    -->
                        <div class="form-group" ng-class="{'has-error':nameUserPwdFindBackForm.userPassEqual.$invalid && ( submitted || nameUserPwdFindBackForm.userPassEqual.$touched)}" hidden>
                            <div class="col-sm-4">
                                <label class="form-control-label">密码一致性</label>
                            </div>
                            <div class="col-sm-4">
                                <div class="col-sm-12">
                                    <input type="text" name="userPassEqual" ng-model="controller.userPassEqual" ng-minlength="3" />
                                </div>
                            </div>
                            <div class="col-sm-4">
                            </div>
                        </div>
                        <!--    -->
                        <!--    -->
                        <!--    -->
                        <div class="form-group" ng-class="{'has-error':nameUserPwdFindBackForm.userPhone.$invalid && ( submitted || nameUserPwdFindBackForm.inputCheck.$touched || nameUserPwdFindBackForm.userPhone.$touched) }">
                            <div class="col-sm-4">
                                <label class="form-control-label">手机号</label>
                            </div>
                            <div class="col-sm-4">
                                <div class="col-sm-12">
                                    <i class="icon">&#xe602</i>
                                    <input class="iconInput form-control" id="inputUserPhone_UserPwdFindBack_HTML" placeholder="手机号" type="text" style="background-color:white;" name="userPhone" ng-model="controller.userPhone" ng-maxlength="11" ng-minlength="11" ng-pattern="/^(13[0-9]|14[0-9]|15[0-9]|18[0-9])\d{8}$/" required />
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="help-block" ng-messages="nameUserPwdFindBackForm.userPhone.$error" ng-if="nameUserPwdFindBackForm.userPhone.$invalid">
                                    <p ng-message="required" ng-bind="'*必填'" ng-cloak></p>
                                    <p ng-message="minlength" ng-bind="'*号码位数过少'" ng-cloak></p>
                                    <p ng-message="maxlength" ng-bind="'*号码位数过多'" ng-cloak></p>
                                    <p ng-message="pattern" ng-bind="'*手机号码不真实'" ng-cloak></p>
                                </div>
                            </div>
                        </div>
                        <!--    -->
                        <!--    -->
                        <!--    -->
                        <div class="form-group" ng-class="{'has-error':nameUserPwdFindBackForm.inputCheck.$invalid && ( submitted || nameUserPwdFindBackForm.inputCheck.$touched)}">
                            <div class="col-sm-4">
                                <label class="form-control-label">验证码</label>
                            </div>
                            <div class="col-sm-4">
                                <div class="col-sm-12">
                                    <i class="icon">&#xe601 </i>
                                    <div class="col-sm-8" style="padding:0px">
                                        <input class="form-control iconInput" placeholder="验证码（六位数字）" type="text" name="inputCheck" ng-model="controller.inputCheck" required ng-maxlength="6" ng-minlength="6" ng-pattern="/\d{6}$/" />
                                    </div>
                                    <div class="col-sm-4" style="padding:0px">
                                        <input class="btn btn-primary angle col-sm-12" onclick="sendMessage_UserPwdFindBack_HTML()" id="btnSendCode_UserPwdFindBack_HTML" value="发送验证码" type="button" ng-disabled="nameUserPwdFindBackForm.userPhone.$invalid" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-4">
                                <div class="help-block" ng-messages="nameUserPwdFindBackForm.inputCheck.$error" ng-if="nameUserPwdFindBackForm.inputCheck.$invalid">
                                    <p ng-message="required" ng-bind="'*必填'" ng-cloak></p>
                                    <p ng-message="maxlength" ng-bind="'*必须填写6位数字'" ng-cloak></p>
                                    <p ng-message="minlength" ng-bind="'*必须填写6位数字'" ng-cloak></p>
                                    <p ng-message="pattern" ng-bind="'*必须填写6位数字'" ng-cloak></p>
                                </div>
                            </div>
                        </div>
                        <!--    -->
                        <!--    -->
                        <!--    -->
                        <script type="text/javascript">
                        var InterValObj_UserPwdFindBack_HTML; //timer变量，控制时间
                        var count_UserPwdFindBack_HTML = 60; //间隔函数，1秒执行
                        var curCount_UserPwdFindBack_HTML; //当前剩余秒数

                        function sendMessage_UserPwdFindBack_HTML() {　
                            //向后台发送处理数据
                            var str = "userPhone=" + document.getElementById("inputUserPhone_UserPwdFindBack_HTML").value;
                            console.log(str);
                            if (str == "userPhone=") {
                                console.log("手机号为空");
                                return false;
                            }
                            $.ajax({　
                                url: 'dreamSpace/userInfo/sendCode.html', //目标地址
                                type: "GET", //用POST方式传输
                                data: str,
                                processData: false, // 告诉jQuery不要去处理发送的数据
                                contentType: false, // 告诉jQuery不要去设置Content-Type请求头
                                error: function(status) {
                                    console.log(status);
                                },
                                success: function(status) {
                                    console.log(status);
                                }
                            });
                            //
                            curCount_UserPwdFindBack_HTML = count_UserPwdFindBack_HTML; //设置button效果，开始计时
                            $("#btnSendCode_UserPwdFindBack_HTML").attr("disabled", "true");
                            $("#btnSendCode_UserPwdFindBack_HTML").val("等待" + curCount_UserPwdFindBack_HTML + "秒");
                            InterValObj_UserPwdFindBack_HTML = window.setInterval(SetRemainTime_UserPwdFindBack_HTML, 1000); //启动计时器，1秒执行一次
                        }
                        //timer处理函数
                        function SetRemainTime_UserPwdFindBack_HTML() {
                            if (curCount_UserPwdFindBack_HTML == 0) {
                                window.clearInterval(InterValObj_UserPwdFindBack_HTML); //停止计时器
                                $("#btnSendCode_UserPwdFindBack_HTML").removeAttr("disabled"); //启用按钮
                                $("#btnSendCode_UserPwdFindBack_HTML").val("重新发送");
                            } else {
                                curCount_UserPwdFindBack_HTML--;
                                $("#btnSendCode_UserPwdFindBack_HTML").val("等待" + curCount_UserPwdFindBack_HTML + "秒");
                            }
                        }
                        </script>
                        <!--    -->
                        <!--    -->
                        <!--    -->
                        <div class="form-group">
                            <div class="col-sm-5"></div>
                            <div class="col-sm-2">
                                <button class="btn btn-primary col-sm-12" type="submit" ng-bind="btnSubmitText">确认修改</button>
                            </div>
                        </div>
                        <!--    -->
                        <!--    -->
                        <!--    -->
                        <div class="form-group has-error">
                            <div class="col-sm-5"></div>
                            <div class="col-sm-7">
                                <div class="help-block" ng-messages="nameUserPwdFindBackForm.$error" ng-if="submitted">
                                    <p ng-bind="'发布失败，请检查填写内容'" ng-cloak></p>
                                </div>
                            </div>
                        </div>
                        <!--    -->
                        <!--    -->
                        <!--    -->
                        <script type="text/javascript">
                        var varReturnData_UserPwdFindBack_FUNCTION_UserPwdFindBack_HTML = "varReturnData_UserPwdFindBack_FUNCTION_UserPwdFindBack_HTML";

                        function userPwdFindBack() {
                            console.log("reset_password");
                            console.log($('#idUserPwdFindBackForm').serialize());
                            $.ajax({
                                type: "post",
                                url: "/dreamSpace/userInfo/registerUser.html", //请求路径
                                data: $('#idUserPwdFindBackForm').serialize(),
                                dataType: "json",
                                async: true,
                                success: function(data) {
                                    console.log("success");
                                    console.log(data);
                                    varReturnData_UserPwdFindBack_FUNCTION_UserPwdFindBack_HTML = data;
                                    if (data.userInfo != false && data.userInfo != undefined && data.userInfo != null) {
                                        setTimeout("window.location.href='/success.html?type=password' ;", 1000);
                                    } else {
                                        console.log("提交失败");
                                    }
                                    //并没有重新生成ID，所以不需要重新注册。
                                },
                                error: function(data) {
                                    console.log("error");
                                    console.log(data);
                                    varReturnData_UserPwdFindBack_FUNCTION_UserPwdFindBack_HTML = data;
                                    console.log(data.status);
                                }
                            });

                        }
                        </script>
                        <!-- -->
                        <!-- -->
                        <!-- -->
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
    <!---->
    <!---->
    <!---->
    <div class="clearfix" style="margin-bottom: 60px;"></div>
    <!---->
    <!---->
    <!---->
    <div ng-include="'includes/footer.html'"></div>
    <!-- -->
    <!-- -->
    <!-- -->
    <!-- JS：AngularJS -->
    <script src="js/angular.min.1.5.8.js"></script>
    <!-- JS：AngularJS-表单提示 -->
    <script src="libs/angular-messages/angular-messages.js"></script>
    <!-- js:jQuery -->
    <script src="libs/jquery/jquery-2.2.4.min.js"></script>
    <!-- js:Bootstrap -->
    <script src="libs/bootstrap-3.3.6/dist/js/bootstrap.min.js"></script>
    <!-- js:bootstrap-datetimepicker -->
    <script src="js/bootstrap-datetimepicker.min.js"></script>
    <!-- js:bootstrap-datetimepicker.zh-CN -->
    <script src="js/bootstrap-datetimepicker.zh-CN.js"></script>
    <!-- js:自定义 -->
    <script src="js/global.js"></script>
    <script type="text/javascript">
    <!-- -->
    <!-- -->
    <!-- -->
    var modUserPwdFindBack_Html = angular.module("appUserPwdFindBack", ["ngMessages"], function() {
        console.log("ng-app : appUserPwdFindBack");
    });
    modUserPwdFindBack_Html.controller("userPwdFindBackController", function userPwdFindBackController($scope, $http) {
        //监视密码是否一致
        $scope.$watch('controller.userPass', function() {
            $scope.pwdsure();
        });
        $scope.$watch('controller.userPassSure', function() {
            $scope.pwdsure();
        });
        $scope.pwdsure = function() {
            console.log("$scope.pwdsure");
            if ($scope.controller.userPass !== $scope.controller.userPassSure && $scope.controller.userPassSure != undefined) {
                $scope.error = true;
                console.log("$scope.pwderror = true");
                $scope.controller.userPassEqual = "1";
            } else {
                $scope.error = false;
                console.log("$scope.error = false");
                $scope.controller.userPassEqual = "100";
            }
        };
        //修改按钮
        $scope.btnSubmitText = "确认修改";
        $scope.$watch('submitted', function() {
            if ($scope.submiting) {
                $scope.btnSubmitText = "修改中 . . .";
            } else if ($scope.submitted) {
                $scope.btnSubmitText = "重新修改";
            }
        });
        //提交表单检测
        $scope.submitted = false;
        $scope.submiting = false;
        $scope.submit = function() {
            console.log("$scope. submitted");
            console.log($scope.submitted);
            $scope.submiting = true;
            debugger;
            if (!$scope.nameUserPwdFindBackForm.$invalid) {
                console.log("表单验证正确");
                userPwdFindBack(); //执行函数
            } else {
                console.log("表单验证有错");
            }
            $scope.submiting = false;
            $scope.submitted = true;
        };
    });
    </script>
</body>

</html>
